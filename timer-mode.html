<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3475887870885804"
    crossorigin="anonymous"></script>

  <title>Skydle - Timer Mode</title>
  <link rel="stylesheet" href="src/style.css">
  <link rel="stylesheet" href="src/timer-style.css">

  <!-- Game scripts -->
  <script src="./constants.js"></script>
  <script src="./wordle.js"></script>
  <script src="./state.js"></script>
  <script src="./app.js"></script>
  <script>
    // Set timer mode
    window.currentGameMode = 'timer';
    console.log("Timer mode loaded");
  </script>
</head>

<body class="timer-body">
  <!-- App div -->
  <div id="app" class="timer-app">
    <!-- Timer Mode Navigation -->
    <nav class="timer-nav">
      <div class="timer-nav-container">
        <button type="button" id="menu-button" class="timer-menu-btn" onclick="window.location.href='index.html'">
          ⚡ Back to Menu
        </button>
        <div class="timer-title">
          <span>⏱️ Timer Challenge</span>
        </div>
        <div class="timer-nav-right">
          <div class="timer-display-main" id="timer-display-main">
            5:00
          </div>
          <button type="button" id="reset-button" class="timer-reset-btn">
            New Word
          </button>
        </div>
      </div>
    </nav>


    <!-- Timer Mode Game -->
    <div id="game" class="timer-game">
      <!-- Game Board -->
      <div id="board-container" class="timer-board-container">
        <div id="board" class="timer-board">
          <div class="row">
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
          </div>
          <div class="row">
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
          </div>
          <div class="row">
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
          </div>
          <div class="row">
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
          </div>
          <div class="row">
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
          </div>
          <div class="row">
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
            <div class="tile timer-tile" data-status="empty"></div>
          </div>
        </div>
      </div>

      <!-- Timer Keyboard -->
      <div id="keyboard-container" class="timer-keyboard-container">
        <div id="keyboard" class="timer-keyboard">
          <div class="row">
            <button data-key="q" class="timer-key">q</button>
            <button data-key="w" class="timer-key">w</button>
            <button data-key="e" class="timer-key">e</button>
            <button data-key="r" class="timer-key">r</button>
            <button data-key="t" class="timer-key">t</button>
            <button data-key="y" class="timer-key">y</button>
            <button data-key="u" class="timer-key">u</button>
            <button data-key="i" class="timer-key">i</button>
            <button data-key="o" class="timer-key">o</button>
            <button data-key="p" class="timer-key">p</button>
          </div>
          <div class="row">
            <span class="half"></span>
            <button data-key="a" class="timer-key">a</button>
            <button data-key="s" class="timer-key">s</button>
            <button data-key="d" class="timer-key">d</button>
            <button data-key="f" class="timer-key">f</button>
            <button data-key="g" class="timer-key">g</button>
            <button data-key="h" class="timer-key">h</button>
            <button data-key="j" class="timer-key">j</button>
            <button data-key="k" class="timer-key">k</button>
            <button data-key="l" class="timer-key">l</button>
            <span class="half"></span>
          </div>
          <div class="row">
            <button data-key="Enter" class="timer-key one-and-a-half">enter</button>
            <button data-key="z" class="timer-key">z</button>
            <button data-key="x" class="timer-key">x</button>
            <button data-key="c" class="timer-key">c</button>
            <button data-key="v" class="timer-key">v</button>
            <button data-key="b" class="timer-key">b</button>
            <button data-key="n" class="timer-key">n</button>
            <button data-key="m" class="timer-key">m</button>
            <button data-key="Backspace" class="timer-key one-and-a-half">
              <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24">
                <path fill="currentColor"
                  d="M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H7.07L2.4 12l4.66-7H22v14zm-11.59-2L14 13.41 17.59 17 19 15.59 15.41 12 19 8.41 17.59 7 14 10.59 10.41 7 9 8.41 12.59 12 9 15.59z">
                </path>
              </svg>
            </button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Bootstrap script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"
    type="module"></script>

  <script>
    let timerInterval = null;
    let remainingTime = 300; // 5 minutes
    let gameStarted = false;

    // Initialize timer mode when page loads
    document.addEventListener("DOMContentLoaded", async () => {
      console.log("Timer mode DOM loaded");
      if (window.initializeGame) {
        await window.initializeGame();
      }

      // Start the timer only once
      if (!gameStarted) {
        startTimer();
        gameStarted = true;
      }
    });

    function startTimer() {
      updateTimerDisplay();

      if (timerInterval) {
        clearInterval(timerInterval);
      }

      timerInterval = setInterval(() => {
        remainingTime--;
        updateTimerDisplay();

        // Change UI urgency as time runs out
        if (remainingTime <= 60) {
          document.body.classList.add('timer-critical');
        } else if (remainingTime <= 120) {
          document.body.classList.add('timer-warning');
        }

        if (remainingTime <= 0) {
          clearInterval(timerInterval);
          endTimerGame();
        }
      }, 1000);
    }

    function updateTimerDisplay() {
      const minutes = Math.floor(remainingTime / 60);
      const seconds = remainingTime % 60;
      const display = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      const timerElement = document.getElementById('timer-display-main');
      if (timerElement) {
        timerElement.textContent = display;
      }
    }

    function endTimerGame() {
      // Get the current word to reveal
      let currentWord = 'UNKNOWN';
      if (window.GameState && window.GameState.getAnswer) {
        currentWord = window.GameState.getAnswer().toUpperCase();
      }

      alert(`Time's Up! The word was: ${currentWord}`);

      // Redirect back to main menu after showing results
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 2000);
    }

    // Reset button functionality - get new word but keep timer running
    document.getElementById('reset-button').addEventListener('click', function () {
      // Only reset the game state, NOT the timer
      if (window.getRandomAnswer) {
        const newWord = window.getRandomAnswer();
        if (window.GameState) {
          window.GameState.answer = newWord;
          window.GameState.attemptCount = 0;
          window.GameState.userAttempts = [];
          window.GameState.highlightedRows = [];
          window.GameState.status = "in-progress";
          if (window.getKeyboard) {
            window.GameState.keyboard = window.getKeyboard();
          }
          window.GameState.save();

          // Clear the board
          const tiles = document.querySelectorAll('.timer-tile');
          tiles.forEach(tile => {
            tile.textContent = "";
            tile.dataset.status = "empty";
            tile.removeAttribute("data-animation");
          });

          // Reset keyboard colors
          const keys = document.querySelectorAll('.timer-key');
          keys.forEach(key => {
            key.dataset.status = "unknown";
          });
        }
      }

      // Don't restart timer - keep it running!
    });

    // Stop timer when game ends successfully
    window.stopTimer = function () {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    };
  </script>
</body>

</html>